name: æ¯æ—¥è«–æ–‡æ’­å®¢ç”Ÿæˆ

on:
  workflow_dispatch: # å…è¨±æ‰‹å‹•è§¸ç™¼
  schedule:
    - cron: "0 16 * * *" # æ¯å¤© UTC 00:00 = å°ç£ 08:00

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 20 # æœ€é•· 20 åˆ†é˜å…§è¦å®Œæˆï¼Œå¦å‰‡è‡ªå‹•å–æ¶ˆ
    steps:
      - name: ç°½å‡ºç¨‹å¼ç¢¼å€‰åº«
        uses: actions/checkout@v4

      - name: è¨­å®š Python ç’°å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: å®‰è£ uv
        uses: astral-sh/setup-uv@v5

      - name: ä½¿ç”¨ uv å®‰è£ä¾è³´å¥—ä»¶
        run: uv sync

      - name: åŸ·è¡Œæ’­å®¢ç”Ÿæˆå·¥ä½œæµç¨‹
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          # èƒŒæ™¯ keep-aliveï¼Œæ¯ 60 ç§’è¼¸å‡ºä¸€æ¬¡è¨Šæ¯ï¼Œé˜²æ­¢ GitHub idle timeout
          while true; do echo "ğŸŸ¡ Keep alive... $(date)"; sleep 60; done &
          # åŸ·è¡Œä¸»ç¨‹å¼
          uv run python main.py
